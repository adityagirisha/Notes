# Section 5 - Active Recon

> Active Recon : Engage with System and Network Resources to collect actionable info

Active Scanning involves
- Scanning networks in phases
- Enumeration Deep Dives for resources
- Evading Detection

Active Scanning Considerations
- Laying Off the Land
- Client Permission
- Thoroughness
- Wireless/Wired Network

Active Scanning as a red team member requires you to avoid tripping firewall, IDS and IPS alerts.

## Scanning 

> Scanning is the process Connecting to available system resources to find more info regarding host

> Enumeration is gathering further info about the scanned resources and deep diving into vulnerability specifics

> Fingerprinting is the forming of a complete image of config and behavior 

> Banner Grabbing is collecting info from banners displayed while host/sys/software speaks with any kind of actor.

Scanning -> Enum -> fingerprinting -> exploitation may become a cyclical process as pen test process continues.

Relevant Info Includes:
- Host and Network Topography
- Network Devices like switches, load balancers, routers, gateways, DMZ
- Host Info like open ports, protocols and services that are implementing the protocols.
- User Info, Domain and website info

## Scanning Levels

> Ping Scan 
> - Initial Layout Mapping
> - Collection basic Host and Network Info
> - IP range, Active IPs, DNS etc

> Quick Scan
> - target found systems to see network behavior and implementation specifics
> - open ports and service
> - what architecture 

> Intense Scan
> - target likely attack vectors to extract exact config and version specifics
> - OS, Protocol Version and Implementer, Software running and version
> - Form digital signature of valuable targets to find linked vuln

## Enumeration

- Enumeration is linking the resources with possible CVEs.
- Different Resources requires usage of different toolsets. 
- Enumerations steps may differ if we have system or user access

- Enumeration on already breached systems requires stealth considerations.
- A common way to practice stealth is by Living of the land (LOTL) which is using existing resources to collect vuln possibilities

### LOTL on Windows

- for network info
  - net command
  - arp command
  - ipconfig command (for DNS)
- for system and windows domain info
  - checking active dir for access controls
  - OU list (users, computers, groups)
  - powershell 

## LOTL on Linux
- network info
  - ping
  - ifconfig
  - arp
- System and user info
  - finger
  - env
  - uname

## Recon on Websites

- Apart from networks themselves. its also important to scan and fingerprint the websites and developed services that are exposed by the devs of the org.
- Info to be collected
  - Port and IP infochallenging
  - Software purposes and capability
  - Language
  - Platform for deployment
    - Private (Own Network)
    - Cloud (AWS)
    - CMS (WordPress)
    - Page Builder (Square Space)
  - user permissions  
  - All Accessible pages
  - All accessible files/scripts/methods


## Evading detection
- Running Full Active and Vuln Scans will surely alert SOCs and blue teams about intruders and bad actors. Good scanning requires bypassing obsrtuctons

- Obstructions to Website Recon
  - Firewalls 
    - firewalls can block calls and suspicious packets and ban IPs. 
    - Evade by testing firewall rulesets
  - Application Firewalls 
    - runs on application layer to check for suspicious activity on app level
    - Evade by masked behavior and ruleset fingerprinting 
  - Load Balancers
    - Some website use LBs and proxies which makes enumeration sometimes
    - Evade by finding direct access paths or scripting the scans to accomodate LBs 
  - Antivirus/IDS/IPS
    - Trigger alerts when suspicious activity is happening on the network hosts.
    - Evasion by LOTL to blend in
    - Evasion Encryption and packet crafting
    - Evasion by metamorphic virus or tools

## Packet Crafting
  - Create distinct and specific packets to scan and attack
  - good tools are hping and scapy
  - objective : stealth, concise, obfuscated
  - Lifecycle of crafting
    1. Assemble
    2. Edit (encrypt an obfuscate)
    3. Play (Send)
    4. Decode (Analyze resp and behaviour)
- Packet crafters like hping and scapy are more versatile than just implemeting lifecycle
  - hping
    - host/port detection
    - firewall testing
    - traceroute mimic
    - fragment
    - dos
  - Scapy
    - Packet gen
    - Network scan and discover
    - Packet Sniffer
## Tools

|Tool|Desc|
|-|-|
|Dir Buster| Brute force url path cracker|
|Cewl|Content Scrapper to generate ptargeted credential wordlist|
|LBD|load balancer detector for website recon|
|Firewalk|Find firewall ruleset|
|Nmap|Ping/Quick/Intense Scan|
|Zenmap|UI version of Nmap|
|hping|packet crafter and firewall tester|
|Scapy|packet crafter and sniffer|
|wireshark/tshark/tcpdump|packet sniffer||
|Cisco Packet Tracer|Network packet trace and network simulation|

## Eavesdropping

> Eavesdroping - Listening to company personnel without consent 

> Tech Eavesdropping - using tools to intercept company comms to collect info

> Packet Sniffing - collecting all packets of network (comms/legit actors/bad actors) to gain info
> packet sniffing can provide comms, automated job info, flow of data analysis, alt company office branches

## Wardriving

> wardriving is the process of intercepting traffic by approaching network proximity

Considerations: 
- wireless is easier to tap into
- antenna specs.
  - DBI: decibels per isotropic
  - uni/bi/multidirectional setup
  - range
  - SNR: signal to noise ratio
  - comms microwave range
- client permission